!function(t){var e=function(t,r){if(r=r||{},this.options=r,this.options.location=r.location||e.defaultOptions.location,this.options.distance="distance"in r?r.distance:e.defaultOptions.distance,this.options.threshold="threshold"in r?r.threshold:e.defaultOptions.threshold,this.options.maxPatternLength=r.maxPatternLength||e.defaultOptions.maxPatternLength,this.pattern=r.caseSensitive?t:t.toLowerCase(),this.patternLen=t.length,this.patternLen>this.options.maxPatternLength)throw new Error("Pattern length is too long");this.matchmask=1<<this.patternLen-1,this.patternAlphabet=this._calculatePatternAlphabet()};e.defaultOptions={location:0,distance:100,threshold:.6,maxPatternLength:32},e.prototype._calculatePatternAlphabet=function(){var t={},e=0;for(e=0;e<this.patternLen;e++)t[this.pattern.charAt(e)]=0;for(e=0;e<this.patternLen;e++)t[this.pattern.charAt(e)]|=1<<this.pattern.length-e-1;return t},e.prototype._bitapScore=function(t,e){var r=t/this.patternLen,i=Math.abs(this.options.location-e);return this.options.distance?r+i/this.options.distance:i?1:r},e.prototype.search=function(t){if(t=this.options.caseSensitive?t:t.toLowerCase(),this.pattern===t)return{isMatch:!0,score:0};var e,r,i,n,s,o,c,a,h,l=t.length,u=this.options.location,d=this.options.threshold,p=t.indexOf(this.pattern,u),f=this.patternLen+l,g=1,L=[];for(-1!=p&&(d=Math.min(this._bitapScore(0,p),d),-1!=(p=t.lastIndexOf(this.pattern,u+this.patternLen))&&(d=Math.min(this._bitapScore(0,p),d))),p=-1,e=0;e<this.patternLen;e++){for(i=0,n=f;i<n;)this._bitapScore(e,u+n)<=d?i=n:f=n,n=Math.floor((f-i)/2+i);for(f=n,s=Math.max(1,u-n+1),o=Math.min(u+n,l)+this.patternLen,(c=Array(o+2))[o+1]=(1<<e)-1,r=o;r>=s;r--)if(h=this.patternAlphabet[t.charAt(r-1)],c[r]=0===e?(c[r+1]<<1|1)&h:(c[r+1]<<1|1)&h|(a[r+1]|a[r])<<1|1|a[r+1],c[r]&this.matchmask&&(g=this._bitapScore(e,r-1))<=d){if(d=g,p=r-1,L.push(p),!(p>u))break;s=Math.max(1,2*u-p)}if(this._bitapScore(e+1,u)>d)break;a=c}return{isMatch:p>=0,score:g}};var r=function(t,e,n){var s,o,c;if(e){-1!==(c=e.indexOf("."))?(s=e.slice(0,c),o=e.slice(c+1)):s=e;var a=t[s];if(a)if(o||"string"!=typeof a&&"number"!=typeof a)if(i.isArray(a))for(var h=0,l=a.length;h<l;h++)r(a[h],o,n);else o&&r(a,o,n);else n.push(a)}else n.push(t);return n},i={deepValue:function(t,e){return r(t,e,[])},isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)}};function n(t,e){var r,i,s,o;for(this.list=t,this.options=e=e||{},r=0,i=(o=["sort","shouldSort"]).length;r<i;r++)s=o[r],this.options[s]=s in e?e[s]:n.defaultOptions[s];for(r=0,i=(o=["searchFn","sortFn","keys","getFn","include"]).length;r<i;r++)s=o[r],this.options[s]=e[s]||n.defaultOptions[s]}n.defaultOptions={id:null,caseSensitive:!1,include:[],shouldSort:!0,searchFn:e,sortFn:function(t,e){return t.score-e.score},getFn:i.deepValue,keys:[]},n.prototype.set=function(t){return this.list=t,t},n.prototype.search=function(t){var e,r,n,s,o=new this.options.searchFn(t,this.options),c=this.list,a=c.length,h=this.options,l=this.options.keys,u=l.length,d=[],p={},f=[],g=function(t,e,r){if(null!=t)if("string"==typeof t)(n=o.search(t)).isMatch&&((s=p[r])?s.score=Math.min(s.score,n.score):(p[r]={item:e,score:n.score},d.push(p[r])));else if(i.isArray(t))for(var c=0;c<t.length;c++)g(t[c],e,r)};if("string"==typeof c[0])for(var L=0;L<a;L++)g(c[L],L,L);else for(L=0;L<a;L++)for(r=c[L],e=0;e<u;e++)g(h.getFn(r,l[e]),r,L);h.shouldSort&&d.sort(h.sortFn);for(var k=h.id?function(t){d[t].item=h.getFn(d[t].item,h.id)[0]}:function(){},v=function(t){var e;if(h.include.length>0){e={item:d[t].item};for(t=0;t<h.include.length;t++){var r=h.include[t];e[r]=d[t][r]}}else e=d[t].item;return e},m=(L=0,d.length);L<m;L++)k(L),f.push(v(L));return f},"object"==typeof exports?module.exports=n:"function"==typeof define&&define.amd?define(function(){return n}):window.Fuse=n}();const fuseOptions={keys:["title","keywords","persons","links.title"],id:"key"},config={selector:{input:".search__control",list:".record-list",item:".record",link:".record__link",activeLink:".record__link--active"}};function start(){document.body.classList.contains("js-disabled")&&document.body.classList.remove("js-disabled");const t=new RecordNavigator;t.start(),fetch("/_data/records.json?cache-bust-2018-10-18").then(t=>t.json()).then(e=>{new RecordSearch(t,e)}).catch(t=>{console.error(t),document.querySelector(config.selector.input).parentElement.remove()})}const controlKeyNames={13:"enter",37:"arrowLeft",38:"arrowUp",39:"arrowRight",40:"arrowDown"};class RecordNavigator{constructor(){this._recordList=document.querySelector(config.selector.list),this._searchInput=document.querySelector(config.selector.input),this._searchInput.parentElement.removeAttribute("hidden"),this.selectLink(this._recordList.querySelector(config.selector.link)),this.controlKey={enter:{trigger:t=>{this.handleEnter(t)}},arrowLeft:{trigger:t=>{this.navigateLink(t,-1)}},arrowRight:{trigger:t=>{this.navigateLink(t,1)}},arrowUp:{trigger:t=>{this.navigateRecord(t,-1)}},arrowDown:{trigger:t=>{this.navigateRecord(t,1)}}}}get recordList(){return this._recordList}get searchInput(){return this._searchInput}start(){document.addEventListener("keydown",this.handleKeyboardInput.bind(this))}handleKeyboardInput(t){if(t.keyCode in controlKeyNames){const e=controlKeyNames[t.keyCode];this.controlKey[e].trigger(t)}}searchInputInFocus(){return document.activeElement===this.searchInput}getSelectedLink(){return this.recordList.querySelector(config.selector.activeLink)}selectLink(t){const e=this.getSelectedLink();e&&e.classList.remove(config.selector.activeLink.slice(1)),t.classList.add(config.selector.activeLink.slice(1))}navigateRecord(t,e){if(t.preventDefault(),this.searchInputInFocus()){const t=this.recordList.querySelector(config.selector.link);return void(t&&(this.selectLink(t),t.focus()))}const r=this.getSelectedLink().closest(config.selector.item),i=Array.from(this.recordList.querySelectorAll(config.selector.item)),n=i.indexOf(r),s=i[n+e];if(s){const t=s.querySelector(config.selector.link);t&&(this.selectLink(t),t.focus())}}navigateLink(t,e){if(this.searchInputInFocus())return;t.preventDefault();const r=Array.from(this.recordList.querySelectorAll(config.selector.link)),i=this.getSelectedLink(),n=r.indexOf(i),s=r[n+e];s&&(this.selectLink(s),s.focus())}handleEnter(t){if(!this.searchInputInFocus())return;t.preventDefault();const e=this.recordList.querySelector(config.selector.link);e&&(this.selectLink(e),e.focus())}}class RecordSearch{constructor(t,e){this._recordNavigator=t,this._recordMarkup=prebuildRecordMarkup(e.entries),this._records=e.entries,this._recordList=document.querySelector(config.selector.list),this._searchInput=this.initSearchInput()}get recordNavigator(){return this._recordNavigator}get recordMarkup(){return this._recordMarkup}get records(){return this._records}get recordList(){return this._recordList}get searchInput(){return this._searchInput}initSearchInput(){const t=document.querySelector(config.selector.input);if(window.location.search.includes("search=")){const e=window.location.search.split("search=")[1].split("&")[0];t.value=decodeURIComponent(e)}let e;return t.value.length>0&&this.buildRecordList(),t.focus(),t.addEventListener("input",()=>{e&&clearTimeout(e),e=setTimeout(()=>{this.buildRecordList()},150)},!1),t}buildRecordList(){const t=this.filterRecordData();let e="";0===this.searchInput.value.length?this.recordMarkup.forEach(t=>{e+=t}):t.forEach(t=>{e+=this.recordMarkup.get(t)}),this.recordList.innerHTML=e,this.recordList.hasChildNodes()&&this.recordNavigator.selectLink(this.recordList.querySelector(config.selector.link))}filterRecordData(){return new Fuse(this.records,fuseOptions).search(this.searchInput.value)}}function prebuildRecordMarkup(t){const e=new Map;for(const r of t)e.set(r.key,buildRecordString(r));return e}function buildRecordString(t){const e=config.selector.item.slice(1);let r=`<li class="${e}" data-key="${t.key}">\n    <div class="${e}__title">${t.title}</div>`;if(t.links.length>0){r+='<nav class="record__links">';for(const i of t.links)r+=`<a class="${e}__link" href="${i.url}">\n        ${i.title}\n      </a>`;r+="</nav>"}return r+="</li>"}document.addEventListener("DOMContentLoaded",start);