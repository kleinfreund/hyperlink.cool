"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function initSearch(t,e){var n=e,i=document.querySelector(config.selector.input);if(window.location.search.includes("search=")){var r=window.location.search.split("search=")[1].split("&")[0];i.value=decodeURIComponent(r)}if(i.value.length>0){var o=filterRecordData(n,i.value);t.buildRecordList(o)}i.focus();var s=void 0;i.addEventListener("input",function(){s&&clearTimeout(s),s=setTimeout(function(){var e=filterRecordData(n,i.value);t.buildRecordList(e)},150)},!1)}function filterRecordData(t,e){var n=Object.values(t);if(0===e.length)return n;var i=new Fuse(n,fuseOptions),r=i.search(e),o=[];return r.forEach(function(e){return o.push(t[e])}),o}function buildRecordString(t){var e=config.selector.item.slice(1),n='\n    <li class="'+e+'" data-key="'+t.key+'">\n      <div class="'+e+'__title">'+t.title+"</div>";if(t.links.length>0){n+='<nav class="nav record-nav">';var i=!0,r=!1,o=void 0;try{for(var s,c=t.links[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var a=s.value;n+='\n        <a class="'+e+'__link" href="'+a.url+'">\n          '+a.title+"\n        </a>\n      "}}catch(t){r=!0,o=t}finally{try{!i&&c.return&&c.return()}finally{if(r)throw o}}n+="</nav>"}return n+="</li>"}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t){function e(t,n){this.list=t,this.options=n=n||{};var i,r,o,s;for(i=0,s=["sort","shouldSort"],r=s.length;i<r;i++)o=s[i],this.options[o]=o in n?n[o]:e.defaultOptions[o];for(i=0,s=["searchFn","sortFn","keys","getFn","include"],r=s.length;i<r;i++)o=s[i],this.options[o]=n[o]||e.defaultOptions[o]}var n=function t(e,n){if(n=n||{},this.options=n,this.options.location=n.location||t.defaultOptions.location,this.options.distance="distance"in n?n.distance:t.defaultOptions.distance,this.options.threshold="threshold"in n?n.threshold:t.defaultOptions.threshold,this.options.maxPatternLength=n.maxPatternLength||t.defaultOptions.maxPatternLength,this.pattern=n.caseSensitive?e:e.toLowerCase(),this.patternLen=e.length,this.patternLen>this.options.maxPatternLength)throw new Error("Pattern length is too long");this.matchmask=1<<this.patternLen-1,this.patternAlphabet=this._calculatePatternAlphabet()};n.defaultOptions={location:0,distance:100,threshold:.6,maxPatternLength:32},n.prototype._calculatePatternAlphabet=function(){var t={},e=0;for(e=0;e<this.patternLen;e++)t[this.pattern.charAt(e)]=0;for(e=0;e<this.patternLen;e++)t[this.pattern.charAt(e)]|=1<<this.pattern.length-e-1;return t},n.prototype._bitapScore=function(t,e){var n=t/this.patternLen,i=Math.abs(this.options.location-e);return this.options.distance?n+i/this.options.distance:i?1:n},n.prototype.search=function(t){if(t=this.options.caseSensitive?t:t.toLowerCase(),this.pattern===t)return{isMatch:!0,score:0};var e,n,i,r,o,s,c,a,l,u=t.length,h=this.options.location,f=this.options.threshold,d=t.indexOf(this.pattern,h),p=this.patternLen+u,v=1,y=[];for(d!=-1&&(f=Math.min(this._bitapScore(0,d),f),d=t.lastIndexOf(this.pattern,h+this.patternLen),d!=-1&&(f=Math.min(this._bitapScore(0,d),f))),d=-1,e=0;e<this.patternLen;e++){for(i=0,r=p;i<r;)this._bitapScore(e,h+r)<=f?i=r:p=r,r=Math.floor((p-i)/2+i);for(p=r,o=Math.max(1,h-r+1),s=Math.min(h+r,u)+this.patternLen,c=Array(s+2),c[s+1]=(1<<e)-1,n=s;n>=o;n--)if(l=this.patternAlphabet[t.charAt(n-1)],0===e?c[n]=(c[n+1]<<1|1)&l:c[n]=(c[n+1]<<1|1)&l|((a[n+1]|a[n])<<1|1)|a[n+1],c[n]&this.matchmask&&(v=this._bitapScore(e,n-1),v<=f)){if(f=v,d=n-1,y.push(d),!(d>h))break;o=Math.max(1,2*h-d)}if(this._bitapScore(e+1,h)>f)break;a=c}return{isMatch:d>=0,score:v}};var i=function t(e,n,i){var o,s,c;if(n){c=n.indexOf("."),c!==-1?(o=n.slice(0,c),s=n.slice(c+1)):o=n;var a=e[o];if(a)if(s||"string"!=typeof a&&"number"!=typeof a)if(r.isArray(a))for(var l=0,u=a.length;l<u;l++)t(a[l],s,i);else s&&t(a,s,i);else i.push(a)}else i.push(e);return i},r={deepValue:function(t,e){return i(t,e,[])},isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)}};e.defaultOptions={id:null,caseSensitive:!1,include:[],shouldSort:!0,searchFn:n,sortFn:function(t,e){return t.score-e.score},getFn:r.deepValue,keys:[]},e.prototype.set=function(t){return this.list=t,t},e.prototype.search=function(t){var e,n,i,o,s=new this.options.searchFn(t,this.options),c=this.list,a=c.length,l=this.options,u=this.options.keys,h=u.length,f=[],d={},p=[],v=function t(e,n,c){if(void 0!==e&&null!==e)if("string"==typeof e)i=s.search(e),i.isMatch&&(o=d[c],o?o.score=Math.min(o.score,i.score):(d[c]={item:n,score:i.score},f.push(d[c])));else if(r.isArray(e))for(var a=0;a<e.length;a++)t(e[a],n,c)};if("string"==typeof c[0])for(var y=0;y<a;y++)v(c[y],y,y);else for(var y=0;y<a;y++)for(n=c[y],e=0;e<h;e++)v(l.getFn(n,u[e]),n,y);l.shouldSort&&f.sort(l.sortFn);for(var g=l.id?function(t){f[t].item=l.getFn(f[t].item,l.id)[0]}:function(){},L=function(t){var e;if(l.include.length>0){e={item:f[t].item};for(var t=0;t<l.include.length;t++){var n=l.include[t];e[n]=f[t][n]}}else e=f[t].item;return e},y=0,m=f.length;y<m;y++)g(y),p.push(L(y));return p},"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=e:"function"==typeof define&&define.amd?define(function(){return e}):window.Fuse=e}(void 0);var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),fuseOptions={keys:["abbr","title","keywords","persons","links.title"],id:"key"};document.addEventListener("DOMContentLoaded",function(){document.body.classList.contains("js-disabled")&&document.body.classList.remove("js-disabled");var t=new RecordNavigator;document.addEventListener("keydown",function(e){if(e.keyCode in controlKeyNames){var n=controlKeyNames[e.keyCode];controlKey[n].trigger(t,e)}}),fetch("_data/records.json").then(function(t){return t.json()}).then(function(e){return initSearch(t,e)}).catch(function(t){console.error(t),document.querySelector(config.selector.input).parentElement.remove()})});var config={selector:{input:".record-filter__input",list:".record-list",item:".record",link:".record__link",activeLink:".record__link--active"}},controlKeyNames={13:"enter",37:"arrowLeft",38:"arrowUp",39:"arrowRight",40:"arrowDown"},controlKey={enter:{trigger:function(t,e){t.handleEnter(e)}},tab:{trigger:function(t,e){t.navigateLink(e,e.shiftKey?-1:1)}},arrowLeft:{direction:-1,trigger:function(t,e){t.navigateLink(e,this.direction)}},arrowRight:{direction:1,trigger:function(t,e){t.navigateLink(e,this.direction)}},arrowUp:{direction:-1,trigger:function(t,e){t.navigateRecord(e,this.direction)}},arrowDown:{direction:1,trigger:function(t,e){t.navigateRecord(e,this.direction)}}},RecordNavigator=function(){function t(){_classCallCheck(this,t),this._recordList=document.querySelector(config.selector.list),this._searchInput=document.querySelector(config.selector.input),this.selectLink(this._recordList.querySelector(config.selector.link))}return _createClass(t,[{key:"searchInputInFocus",value:function(){return document.activeElement===this.searchInput}},{key:"getSelectedLink",value:function(){return this.recordList.querySelector(config.selector.activeLink)}},{key:"selectLink",value:function(t){var e=this.getSelectedLink();e&&e.classList.remove(config.selector.activeLink.slice(1)),t.classList.add(config.selector.activeLink.slice(1))}},{key:"navigateRecord",value:function(t,e){if(t.preventDefault(),this.searchInputInFocus()){var n=this.recordList.querySelector(config.selector.link);return void(n&&(this.selectLink(n),n.focus()))}var i=this.getSelectedLink().closest(config.selector.item),r=Array.from(this.recordList.querySelectorAll(config.selector.item)),o=r.indexOf(i),s=r[o+e];if(s){var c=s.querySelector(config.selector.link);c&&(this.selectLink(c),c.focus())}}},{key:"navigateLink",value:function(t,e){if(!this.searchInputInFocus()){t.preventDefault();var n=this.getSelectedLink(),i=Array.from(this.recordList.querySelectorAll(config.selector.link)),r=i.indexOf(n),o=i[r+e];o&&(this.selectLink(o),o.focus())}}},{key:"handleEnter",value:function(t){if(this.searchInputInFocus()){var e=this.recordList.querySelector(config.selector.link);e&&(this.selectLink(e),e.focus()),t.preventDefault()}}},{key:"buildRecordList",value:function(t){var e="";t.forEach(function(t){return e+=buildRecordString(t)}),this.recordList.innerHTML=e,this.recordList.hasChildNodes()&&this.selectLink(this.recordList.querySelector(config.selector.link))}},{key:"recordList",get:function(){return this._recordList}},{key:"searchInput",get:function(){return this._searchInput}}]),t}();